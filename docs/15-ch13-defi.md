# 第十三章：去中心化金融

以太坊的智能合约已经开启了一个超越简单加密货币交易的新世界。去中心化金融（DeFi） 将这一进程推向了新的高度，
它构建了一个完全运行在区块链上的完整金融生态系统。想象一下，像借贷、交易和投资等传统金融服务，如今无需银行、经纪商或任何中心化机构即可实现。
取而代之的是，以太坊区块链上的智能合约处理一切，开启了一个财务自主和创新的新时代。

这种去中心化的方式使金融服务的获取变得民主化，并引入了传统金融中往往缺失的透明度和安全性。区块链上的每一笔交易都是公开记录且不可篡改的，
任何人都可以验证数据的真实性和完整性。这种透明度降低了欺诈和腐败的风险，创造了一个更值得信赖的金融环境。

DeFi 还为全球范围内的普惠金融开启了机遇。在传统银行基础设施不发达或无法触达的地区，DeFi 提供了一个可行的替代方案。
人们只需一部智能手机和互联网连接，即可参与全球经济。通过提供以往遥不可及的信贷、储蓄账户和投资机会，这项技术有潜力改善数百万人的生活。
以太坊智能合约的可编程性允许创建复杂的金融工具和服务，而这些在传统金融体系中往往难以甚至无法实现。

目前，DeFi 的主要用户可能还不是发展中国家那些银行服务缺失或匮乏的人群，而是来自发达国家、希望利用加密货币高度投机属性获利的个体。
虽然投机空间永远存在，但确保全球每个人都能获得普惠性金融产品，这一点至关重要。

## DeFi 与传统金融（TradFi）

DeFi 是加密朋克对传统金融（TradFi）体系的回应。它代表了一个仍在演进的领域，但已经拥有了核心用户群和充满创新精神的开发者。
DeFi 与 TradFi 之间的区别非常复杂，但最显著的差异在于交易媒介以及区块链固有的开放性与透明性。DeFi 主要使用去中心化程度不一的加密货币，
而 TradFi 依赖于中心化程度最高的法定货币。

TradFi 体系通常设有极高的准入门槛。开设银行账户、获取贷款或投资金融市场通常需要大量的证明文件，并符合各种监管要求。
这一过程排斥了全球大部分人口，特别是那些银行服务欠发达地区的人群。这可以从图 13-1 中看出。

![Figure 13-1](<./images/figure 13-1.png>)

图 13-1. 传统金融与 DeFi 贷款要求对比

普通用户申请贷款需要具备许多前提条件，例如：身份证、可证明的居住地址、社会安全号码、银行账户、签署的文件以及良好的信用评分。
即便具备了所有这些条件，申请仍可能被拒绝；即使获批，通常也需要耗费漫长的等待时间。

而在 DeFi 中，只需要三个前提条件：一部手机、互联网连接、以及足以进行超额抵押的资产。一旦具备这些条件，贷款就是即时的、去中心化的且无需许可的。

DeFi 在设计上更具可及性。任何拥有互联网连接的人都可以与 DeFi 协议交互，这向数十亿被排除在传统体系之外的人开启了金融服务的大门。
DeFi 的高可及性使得 TradFi 中评估信用和解决欺诈的传统机制难以甚至无法应用，一些人将其视为缺点，而另一些人则认为这是一种进步。

DeFi 另一个引人入胜的方面是它有能力创造出传统金融体系中不可能存在的新型金融工具。例如，闪电贷（Flash Loans） 允许用户在无需抵押的情况下借入资金，
只要在同一笔交易中偿还贷款即可。这种 DeFi 特有的能力为套利、抵押品置换和其他复杂的金融操作开启了无限可能，而这些在 TradFi 中是根本无法复制的。

## DeFi 原语 (DeFi Primitives)

如果说像比特币这样的加密货币旨在改进并去中心化“货币”的概念，那么 DeFi 项目则是以此为基础，进一步实现“金融服务”的去中心化与改进。
要全面掌握 DeFi 所提供的各类金融服务，理解以下几个核心概念（即“原语”）至关重要。

> [!Tip]
> **译者注**
> 在工程和计算机科学中，“原语”是指构成更复杂系统的最基础构建块。在 DeFi 领域，原语就像是“金融乐高”，开发者可以像搭积木一样将它们重新组合，创造出前所未有的金融产品。

### DeFi 中代币的可接受性

在以太坊的 DeFi 生态系统中，每种代币都作为一个独立的合约运行。这可能会让初学者感到困惑，因为市面上可能存在名称和功能极其相似的代币，但在现实中，它们是完全不同形式的货币。

以以太坊的 Arbitrum Rollup 为例：那里有两种代币——USDC.e 和 USDC。它们看起来几乎一模一样，但在风险和可接受性方面有着显著差异。
虽然 USDC.e 和 USDC 都旨在维持与 1 美元挂钩的价值，但 USDC 是在 Arbitrum 链上原生发行的，而 USDC.e 则是 USDC 的跨链桥接版本，
代表从其他链转移到 Arbitrum 的代币。

这两者的风险概况（Risk Profiles）截然不同。USDC.e 承载了 USDC 所有的固有风险，同时还叠加了与跨链桥接过程相关的额外风险，
例如潜在的智能合约漏洞。可接受性（定义为一种代币在各种 DeFi 金融服务中被接受的广泛程度）在两者之间也各不相同。
某些协议可能只支持 USDC.e，另一些可能只支持原生 USDC，而还有一些可能两者都接受。 

### 去中心化交易所 (DEX)

去中心化交易所（DEX） 是一个允许你与其他用户直接交易加密货币的平台，无需中心化机构或中介参与。DEX 不再依赖公司来促成交易，
而是利用智能合约自动管理每一笔交易。这使你能够始终保持对个人资金的控制权。

#### DEX 的演进

如果你曾在中心化交易所交易过，一定对**订单簿**（Order Book）模型非常熟悉。在这种模型中，买单和卖单列出了用户愿意支付或接受的价格。
当买单与卖单匹配时，交易即执行。订单簿显示了所有挂单，让交易者能直观看到市场深度和流动性。

在链上，这种模型从未真正流行起来，因为区块链的处理速度比传统网站慢得多，且使用成本更高。
订单簿交易的延迟以及为每一笔挂单支付交易费（Gas）的需求，导致用户体验极其糟糕。2017 至 2018 年间，EtherDelta 曾尝试实现链上订单簿，
随后也有其他一些纯订单簿模型问世，但都未能获得太多关注。

Bancor 率先开创了自动做市商（AMM）模型。与订单簿模型不同，AMM 不依赖买家和卖家下单，而是使用流动性池（Liquidity Pools），
由用户提供成对的代币，代币并不总是成对出现，因为某些流动性池可以包含三种或更多代币，但最常见且最简单的排列是成对的。
价格由基于池中代币比例的公式决定。这种模型实现了持续的流动性和交易。

Uniswap 凭借其简单而有效的 $x \times y = k$ 公式，显著改进并普及了 AMM 模型。在该公式中，两个代币的数量乘积保持不变。
这里，$x$ 和 $y$ 代表池中两种代币的数量，$k$ 是一个常数值。当交易发生时，代币的数量会发生变化，但两者的乘积保持不变，
从而确保资金池始终能提供流动性。这一创新使得去中心化交易所的交易变得更加便捷和高效。

DEX 使得任何人都能通过提供流动性并赚取手续费来成为做市商。只要有足够的流动性，交易就可以快速发生，
且无需中心化机构的许可，正如图 13-2 所示。从图 13-2 来看，BTC 似乎可以在 DEX 上进行原生交易。
然而事实并非如此。DEX 上的 BTC 通常由 Wrapped Bitcoin (WBTC) 等衍生合约代表，这些资产挂钩 BTC 的价格，
但比 BTC 区块链上的原生 BTC 具有显著更高的风险。原生资产通常仅在其各自的原生链上可用。
在本例中，池中使用的 BTC 并非原生 BTC，而是一种类似于稳定币代表法定货币的衍生品。

![Figure 13-2](<./images/figure 13-2.png>)

图 13-2. 去中心化交易所流动性池

#### 无常损失 (Impermanent Loss)

在 DEX 上提供流动性并非毫无风险。除了智能合约被黑客攻击的风险外，还存在一种更隐蔽的风险，称为无常损失。
要理解无常损失，我们首先需要掌握 Uniswap V2 资金池的基础模型。 

许多流行的 DEX（如 Uniswap V2）使用恒定乘积公式 $x \times y = k$，其中 $x$ 和 $y$ 是流动性池中两种代币的数量，
$k$ 是一个常数。代币的价格由池中代币的比例决定。例如，如果一个池子包含 100 USDC 和 10 ETH，那么 1 ETH 的价格就是 $100 \div 10 = 10$ USDC。
如果池子变为 200 USDC 和 10 ETH（由于交易引起），1 ETH 的价格就变成了 $200 \div 10 = 20$ USDC。

这个公式是理解资金池运作方式的一种简化途径。通过提供流动性，你扮演了做市商的角色。当用户从池中购买 ETH 时，
你卖出 ETH 并换回 USDC；当他们卖出 ETH 时，你买入 ETH 并支付 USDC。作为回报，你赚取交易手续费。
然而，这个过程让你暴露在无常损失之下：当池中代币的价格与你存入时相比发生变化，这种损失就会发生。
如果 ETH 的价格大幅上涨或下跌，即便你收取了手续费，你持有的资金池资产总值也可能低于你当初单纯持有原始代币的价值。

此外，这种开放性也给 DEX 带来了重大挑战。由于任何人都可以创建区块链并上线 DEX，目前各种区块链上已有上百家（甚至更多）DEX。
这种过剩导致了流动性碎片化，使得“兑换（Swap）”——即用户交换加密货币的行为——效率低于那些流动性集中的平台。
碎片化会导致更高的滑点（Slippage），即交易的预期价格与实际成交价格之间的差额。当流动性不足时，就会出现高滑点，
导致交易以比预期更差的价格执行。

#### 为什么恒定乘积公式行之有效
$x \times y = k$ 公式的精妙之处在于它的数学形态：一条双曲线。这并非巧合，而是一种刻意的设计选择，旨在保护流动性池不被完全耗尽。

#### 线性定价的问题
想象一下，如果去中心化交易所（DEX）改用简单的线性定价公式，即无论资金池剩余多少流动性，兑换 1 ETH 永远只能得到固定的 2 USDC。
这会产生一个灾难性的漏洞：
1. 清空风险：攻击者可以用手中的所有 USDC 兑换 ETH，直到将池子里的 ETH 完全抽干。
2. 失衡状态：此时，资金池将处于持有 0 ETH 和全部 USDC 的极端状态。
3. 循环攻击：由于价格不会根据剩余流动性进行调整，攻击者随后可以反向操作。
4. 归零风险：通过一系列交易，整个资金池的双边资产都有可能被彻底洗劫一空。

这就是为什么固定价格或线性曲线从根本上不适合自动做市商（AMM）的原因——它们允许资金池被完全抽干。

#### 双曲线解决方案
恒定乘积公式 $x \times y = k$ 产生的是一条双曲线，它拥有一个至关重要的特性：永不触碰坐标轴。
当你试图购买越来越多的某种代币时，其价格会呈指数级增长。从数学逻辑上讲，这使得将池中任何一种代币抽减至零都变得不可能。

![Figure 13-0](<./images/figure 13-0.png>)

假设一个包含 100 ETH 和 200 USDC 的资金池（$k = 20,000$）：
* 用 1 ETH 兑换 USDC：你将收到约 1.98 USDC（接近 1:2 的市场比例）。
* 用 50 ETH 兑换 USDC：你只能收到 66.67 USDC（而非线性模型所暗示的 100 USDC）。
* 试图换走全部 200 USDC：你需要提供无穷大数量的 ETH。计算输出金额的公式为：

$$\Delta y = \frac{y \cdot \Delta x}{x + \Delta x}$$

其中 $\Delta x$ 是输入金额， $\Delta y$ 是输出金额。随着 $\Delta x$ 趋向于无穷大，
$\Delta y$ 会无限趋近于 $y$（总储备量），但永远无法达到它。

这种渐近行为（Asymptotic behavior）正是 AMM 安全性的来源。交易量相对于资金池规模越大，汇率就越差。
这产生了滑点（Slippage）——即预期价格与实际执行价格之间的差额——它自然地抑制了那些会严重耗尽资金池的交易。

双曲线确保了流动性池具有自我保护机制：某种代币越稀缺，它就变得越昂贵，从而形成一道经济屏障防止池子被抽干。
正是这种优雅的数学特性，使得 Uniswap 简单的公式在实现无须信任、无需许可的交易方面具有革命性意义。

> [!Note]
> Uniswap 无疑是当前 DeFi 领域中最重要的项目之一，它的灵感源自 Vitalik Buterin 在 2016 年发布的一篇 Reddit 帖子。
> 据报道，Hayden Adams 在没有任何编程经验的情况下，花费了一年时间，使用 Vyper 编程语言开发出了 Uniswap V1。

### 借贷市场

借贷市场（Lending Market）或称货币市场（Money Market）是一个去中心化平台，它通过智能合约自动执行并保障整个流程，
从而实现加密货币的借、贷功能。与传统金融体系不同，借贷市场在没有银行等中介机构的情况下运行，提供了一种更透明、更高效的贷款处理方式。

在借贷市场中，想要通过加密资产赚取利息的用户可以将资金存入借贷池（Lending Pool）。这些存款贡献了平台的整体流动性。
贷款人赚取存款利息，利率通常根据池内的供需关系通过算法确定。借款需求越高，利率就越高，从而激励更多贷款人向池中贡献资产。

另一方面，借款人可以通过提供抵押品来获取这些资金，抵押品的价值通常高于他们希望借入的金额。这种超额抵押在借贷中至关重要，
目的是降低违约风险，主要是因为大多数加密资产波动性极大。如果贷款没有超额抵押，一旦发生违约，可能会给借贷市场留下坏账³。
抵押品被锁定在智能合约中，确保如果借款人未能偿还贷款，抵押品可以被清算以覆盖欠款。

坏账是指借款人违约且剩余抵押品不足以覆盖欠款的情况。这可能因市场突然剧烈波动或抵押品估值不当而发生。
与通过出售抵押品来清偿债务的“清算”不同，坏账是无法收回的，会导致借贷协议及其用户遭受损失。

该系统保护了贷款人并确保借贷池维持偿付能力。图 13-3 展示了一个简化版本：贷款人提供流动性并收取由借款人支付的年化利息，
而借款人则提取所提供的流动性。

![Figure 13-3](<./images/figure 13-3.png>)

图 13-3. 借贷市场基础流程

借贷市场的利率是动态的，根据市场状况不断波动。平台的算法会持续调整利率，以平衡可用资金的供应与贷款需求。
这创造了一个高效且响应迅速的金融生态系统，贷款人和借款人都能从中获得公平的、由市场驱动的收益或成本。

抵押率（Collateralization Ratios） 是借贷市场的另一个重要方面。这些比率决定了担保一笔贷款所需的抵押品数量。
例如，常见的抵押率可能是 150%，这意味着要借入价值 100 美元的加密货币，借款人需要存入至少价值 150 美元的抵押品，
正如图 13-4 所示。这确保了有足够的缓冲空间来吸收因价格波动可能带来的损失。

![Figure 13-4](<./images/figure 13-4.png>)

图 13-4. 借贷市场抵押机制

如果抵押品的价值跌破特定阈值，平台的智能合约就会启动清算程序（Liquidation Process）。这涉及出售抵押品以偿还贷款，
从而保护贷款人免受潜在损失。清算机制对于维持借贷池的稳定性及偿付能力至关重要。

#### DeFi 中的激励机制

DeFi 的绝大多数环节都是公开的，并高度依赖合理的激励机制来有效运作。例如，大多数借贷市场的清算过程都有赖于用户持续监控那些可被清算的贷款。
一旦发现此类贷款，他们就会执行清算。为了激励用户执行这些任务，他们会获得清算金额的一部分作为奖励。

这种激励概念是区块链和 DeFi 的基石。系统内的许多机制都是围绕博弈论原则设计的，以确保参与者的行为能够维护并提升网络的功能性与安全性。
激励机制将用户行为与协议的总体目标对齐，从而创造出一个自我维持的生态系统。

与 DeFi 中的大多数事物一样，**可组合性**（Composability）是核心。孤立地看，借贷市场似乎并不那么令人惊叹，
尤其是考虑到大多数贷款都需要超额抵押。然而，当你将贷款能力与其他 DeFi 原语结合时，你就能解锁强大的聚合效应，实现多种金融目标。

例如，你可以通过结合“借贷市场”和“DEX”来重新构建一种名为**做空**（Shorting）的金融工具。做空是一种当你预期资产价格会下跌时使用的策略。
本质上，你借入资产并按当前价格卖出，希望以后能以更低的价格买回，归还借入的资产，并赚取差价。

以下是你在 DeFi 中实现做空的方法：
1. 抵押资产 A：在借贷市场存入资产 A 作为抵押品。
2. 借入资产 B：借入你想要做空的资产 B。
3. 在 DEX 上卖出资产 B：在去中心化交易所卖出借入的资产 B。

通过这种操作，你实际上以 1 倍杠杆（做空头寸的大小与借入的金额直接相关）成功做空了资产 B。如果资产 B 的价格下跌，
你可以以更低的价格买回它，偿还贷款，并保留差价，正如图 13-5 所示。这证明了 DeFi 协议的可组合性如何能在去中心化环境中重现传统的金融策略。

![Figure 13-5](<./images/figure 13-5.png>)

图 13-5. 使用 DeFi 实现的做空策略

借贷市场的应用场景非常广泛，且有些用途并非一眼就能看出的。你可能会疑惑：既然我已经有钱了，为什么还要去申请一笔超额抵押贷款？
为什么不直接使用自己的资金？在某些场景下确实如此。然而，借贷市场与 DEX 的结合可以重构各种金融工具，
甚至能让你实现资产的**做多**（Longing）而非做空。借贷市场的另一个好处是能够规避**征税事件**（Taxable Events）。
在许多司法管辖区，借入资产不被视为征税行为，而卖出资产则需要纳税。

借贷市场的潜在用途非常广泛，超出了本书的讨论范围。但不可否认的是，借贷市场提高了资本效率，并在与其他协议结合时，
为用户提供了极大的灵活性。目前也存在一些不需要超额抵押的借贷市场，尽管它们目前尚未获得显著的关注。

### 预言机 (Oracles)

以太坊的预言机（我们在第 11 章中曾详细讨论过）是一种将现实世界数据带入区块链的服务，它允许智能合约与外部信息进行交互。
例如，它可以提供加密货币的价格数据、天气状况或体育比赛比分，从而使智能合约能够根据这些外部数据执行逻辑。

预言机对于 DeFi 的许多方面都至关重要，包括借贷市场的安全性。在这些市场中，代币价格可以从 DEX（去中心化交易所）获取。
然而，仅仅依赖这些交易所可能会使借贷市场容易受到闪电贷攻击（Flash-loan Attacks）。在这种攻击中，攻击者借入巨额资金，
操纵 DEX 上某种代币的价格，并利用这一价格变动牟利。

预言机的另一个核心功能是能够将伪随机数带到链上。由于以太坊是确定性的，每一次计算都必须在任何时候产生相同的结果，
以便节点能够一致地验证每一个区块和交易。然而，这种确定性意味着以太坊内部组件无法产生真正的随机性。例如，如果你正在构建一个博彩平台，
生成随机数就至关重要。虽然可以使用区块时间戳、哈希值或交易计数来创建伪随机数，但这种方法很容易受到攻击，
因为区块提议者（Proposers）可以预先预测或操纵这些属性，从而从博彩平台中牟利。

预言机让以太坊区块链能够使用外部数据，为不同的应用开启了更多可能性。

> [!Tip]
> 从上述描述来看，预言机似乎是一个中心化实体，这会让本应去中心化的 DeFi 对其产生依赖。
> 然而，虽然 DeFi 的某些方面确实依赖预言机，但预言机本身通常是高度去中心化的，不存在单点故障。

### 稳定币 (Stablecoins)

稳定币是一种旨在保持价值稳定的加密货币，通常挂钩于某种储备资产，如美元、欧元或一篮子商品。
它们旨在将加密货币的优势（如安全性、去中心化）与传统法定货币的稳定性结合起来。

稳定币通过不同的机制实现其稳定性。法币抵押型稳定币由存放在银行或其他受信任托管机构中的法定货币储备作为支持。
例如，每一个 USDC 或 USDT 代币通常都有等额的美元（USD）作为后盾。

加密资产抵押型稳定币则采取了不同的方法，由其他加密货币作为支持。考虑到加密资产的波动性，这类稳定币通常采用超额抵押，
以确保能够维持其挂钩汇率。一个著名的例子是 MakerDAO 的 DAI（MakerDAO 现已更名为 Sky，DAI 现已更名为 USDS），用户通过锁定以太坊或其他加密货币作为抵押品来铸造 DAI。
超额抵押为底层资产的剧烈波动提供了缓冲空间。

此外还有算法稳定币，它们不依赖抵押品，而是利用算法和智能合约来管理稳定币的供应量，从而保持价值稳定。
这些稳定币根据市场需求调整供应，通过扩张或收缩供应量来维持目标价格。TerraUSD (UST) 曾是算法稳定币的一个显著代表，
尽管它后来遭遇了严重问题并导致崩盘。

历史上尚未出现过真正成功且具备大规模资金实力的算法稳定币；每一种构建此类稳定币的尝试要么以灾难性的失败告终，要么未能找到市场契合点。

稳定币还极大地提升了 DEX 的流动性。通过提供一种稳定且可预测的资产，它们促进了更顺畅的交易和更高的市场效率。
交易者可以轻松地建仓或平仓，而无需担心价格剧烈波动，这对于高效的市场运作至关重要。

#### 法币抵押型稳定币的局限性

一个有趣的观点是：像 USDC 或 USDT 这样可以在 Coinbase 或 Bitfinex 等平台兑换为美元的稳定币，
其市值（Market Cap）增长潜力是有限的。市值是指流通中所有代币的总价值，计算方法是代币的当前价格乘以总供应量。

这种限制的原因在于：如果特定区块链上稳定币的总价值超过了攻击该区块链的成本，就会产生巨大的诱因，促使恶意行为者尝试发起攻击。
这是因为攻破区块链的潜在回报可能超过攻击成本，使其成为一种现实且可量化的风险。

所幸，攻击像以太坊这样稳健且安全的区块链既不容易也不便宜。此类攻击的高昂成本和复杂性提供了强大的威慑力。
然而，在考虑任何区块链上稳定币的可扩展性和安全性时，始终牢记这一概念至关重要。

### 流动性质押 (Liquid Staking)
流动性质押是一种允许用户在权益证明（PoS）网络中质押其加密资产，同时保留这些资产流动性的机制。
通常情况下，代币一旦被质押就会被锁定，在质押期结束前无法访问或交易。流动性质押通过发行一种代表质押资产的衍生代币解决了这一问题。
这种衍生代币可以被交易、转账或用于其他 DeFi 协议，使用户在赚取质押奖励的同时仍能保持资金的流动性。

例如，如果你在流动性质押平台上质押 ETH，你可能会收到一种类似 stETH 的衍生代币。虽然你的原始 ETH 仍处于质押状态并持续产生收益，
但 stETH 代币可以自由交易或参与其他 DeFi 活动。这让你在不失去资金控制权的前提下，享受到了质押带来的收益。

> [!Note]
> 一种类似于流动性质押的新型衍生品正在兴起，即流动性再质押（Liquid Restaking）。通过像 EigenLayer 这样的协议，
> 代币不仅为以太坊链提供质押保护，还被用于保障其他服务的安全，这一过程被称为“再质押”。这一新发展引发了人们对比特币共识机制可能载荷过重的担忧。

流动性质押所获得的代币（如 Lido 发行的 stETH）其运作方式类似于挂钩 ETH 价格的稳定币。
这意味着它不仅带有与法币稳定币（如美元挂钩币）类似的风险，还增加了与罚没（Slashing）相关的额外风险。
流动性质押协议将用户存入的 ETH 进行质押并创建验证者节点，赚取质押奖励，随后将这些奖励重新分配给衍生代币的持有者。
这一过程引入了罚没风险：如果验证者节点运行不当或违规，部分质押的 ETH 可能会被扣除。

除了这些风险，流动性质押还可能对区块链本身造成系统性风险。例如，在撰写本文时，Lido 质押的 ETH 占全网总质押量的 29%。
如果这一比例增加到 33% 或更高，可能会引发严重问题（如果任何质押者拥有超过 33% 的质押 ETH，
理论上他们可以攻击网络并阻止区块的最终确认（Finalization）过程）。2022 年 6 月，Lido DAO 曾发起一项投票，
提议限制 Lido 的质押权力，防止其超过 33% 的阈值，以避免对以太坊造成潜在的系统性风险。遗憾的是，该投票未能通过。

> [!Note]
> 这次投票也引发了巨大争议，因为大部分反对票仅来自于极少数的几个钱包。

### 现实世界资产 (Real-World Assets, RWAs)
在 DeFi 的背景下，现实世界资产（RWAs）是指被代币化并引入区块链的实物资产或传统金融资产。
这些资产可以包括从房地产、大宗商品到股票、债券，甚至是艺术品。资产代币化的过程涉及将其价值转换为数字代币，
使其可以在区块链平台上进行交易、抵押或借贷。

RWA 领域存在一定的争议，因为它们通常需要托管人（Custodian），这与区块链的“无须信任（Trustless）”原则相违背。
该领域是 DeFi 中最后真正兴起的板块之一，到目前为止，主要的 RWA 协议尚未出现重大问题。尽管违背了加密货币的核心特质，
但 RWA 开启了无数新的可能性。

RWA 的一个重要应用是将债券引入链上，让用户能够获得相对“无风险利率”。这使得非美国公民也能够获得 2023 年至 2024 年期间美国市场约 5% 的利率收益。
RWA 的另一个价值在于代币化资产的分散化（Fractionalization），例如让普通人能够拥有一处房地产的小部分所有权。

鉴于该领域仍处于起步阶段，我们尚未发掘其全部潜力。然而，与托管相关的风险是真实存在且令人担忧的。

### 跨链桥与全链协议
随着区块链生态系统的演变，出现了各种具有独特功能和优势的网络。然而，这些网络通常处于孤立状态，
这限制了资产和数据在它们之间的无缝传输。跨链桥和全链（Omnichain）协议旨在通过促进跨链交互来解决这一问题，
最终创建一个更加互联的区块链生态系统。

> [!Note]
> 跨链桥通常是非常中心化的，因为大多数区块链对其他链的状态是“无感”的。当资金从 A 链转移到 B 链时，
> 通常会有一个中心化权威机构来批准跨链操作并在 B 链上解锁流动性。这种中心化特质也是跨链桥成为 DeFi 中最常遭受黑客攻击的协议之一的原因。

跨链桥是专门用于促进不同区块链之间资产和数据传输的协议，正如图 13-6 所示。它们充当连接器的角色，
允许代币和其他数字资产从一条链移动到另一条链。例如，如果你想将你的代币从以太坊（Ethereum）转移到币安智能链（BSC），你就需要使用跨链桥。

![Figure 13-6](<./images/figure 13-6.png>)

图 13-6. 连接两条区块链的跨链桥

将代币从一条链跨链至另一条链有许多不同的模型。每种跨链桥都采用特定的模式，最常见的如下：

**包装代币桥（锁定与铸造，Lock and Mint）**

在这种模型中，跨链桥在 A 链接收代币并将其锁定在智能合约中，同时在 B 链铸造一种包装代币（或称“专属代币”）。
包装代币充当代表被锁定资产的收据。要取回原始代币，需在 B 链销毁包装代币，从而在 A 链解锁资产。

示例：假设你使用“Mastering Bridge”将 ETH 从以太坊转到 BSC。你向以太坊上的桥合约发送 ETH，
桥会在 BSC 上铸造一种包装代币，例如“MasteringETH”。回传时，你在 BSC 销毁 MasteringETH，
桥释放原始 ETH。这些包装代币通常需要在 DEX 上兑换才能获得 B 链的原生代币。

**铸造与销毁（Mint and Burn）**

该模型通常由掌握代币铸造和销毁权限的项目方使用。跨链桥不在 A 链锁定代币，而是直接销毁代币（减少供应量），
并在 B 链铸造等量代币。这要求项目方拥有代币合约的控制权。例如，项目可以销毁以太坊上的代币并在 BSC 铸造同类代币，保持跨链总供应量不变。

**流动性桥（Liquidity Bridges）**

这是最常见的类型，依赖于多条链上的代币池。当你跨链时，桥利用其流动性池在目标链向你发送等值代币，通常收取手续费。
与包装代币桥不同，这里不铸造新代币，桥本身就在两条链上持有资产。

接着之前的例子，如果你将 ETH 从以太坊跨链至 BSC，你向以太坊上的桥发送 ETH，桥随后从其 BSC 的流动性池中释放 ETH。
如果桥不具备铸造权限，它必须在 BSC 维持充足的流动性。该模型因简单而流行，但依赖于桥安全管理流动性的能力。

*全链（Omnichain）协议*（在第 11 章中作为跨链消息传递协议讨论过）扩展了跨链交互的概念，实现了多个区块链之间同时进行无缝通信和互操作。
这些协议旨在创建一个统一层，使不同区块链可以无摩擦地交互，允许资产、数据甚至智能合约功能跨链传输。图 13-7 展示了一个简单的全链消息协议，
用户可以在以太坊发起交换，并在 BSC 完成交换并接收资金。

![Figure 13-7](<./images/figure 13-7.png>)

图 13-7. 全链协议示例

## (去)中心化金融
去中心化（Decentralization）一词总是难以定义，它往往更多地是表达一种理想化的结果，而非对现实的准确描述。
大多数 DeFi 协议并非真正的去中心化；它们通常依赖具有重大特权的特定地址，或由核心开发团队做决策，从而在所谓的去中心化系统中形成了权力中心化。

DeFi 仍处于早期阶段，其未来的形态和发展方向很大程度上取决于早期参与者的塑造。虽然去中心化是终极目标，但必须承认这并非当下的现实。
像 DeFi 这样的新兴市场可以从一定程度的中心化中获益，以便迅速做出决策并实施变革。这种中心化的决策机制能够提供在快速演变的环境中进行适应和增长所需的灵活性。

随着 DeFi 的不断成熟，目标应当是逐步减少中心化，并向更完善的去中心化模式转型。早期参与者在这一转型过程中扮演着至关重要的角色，
他们需要平衡当前的效率与快速决策需求，以及去中心化的最终愿景。通过理解并处理这些固有的权衡（Trade-offs），DeFi 社区可以引导系统的演化，
使其更好地契合开放、透明和包容的基础原则。

## DeFi 的风险与挑战

DeFi 伴随着一系列独特的风险与挑战，这些风险往往被用户（甚至包括专家）所误解。每个 DeFi 协议都承载着特定的经济风险和通用的智能合约风险。
此外，根据去中心化程度的不同，还可能存在托管风险或中心化问题。

智能合约风险较易概括：智能合约可能被黑客攻击，托管人可能作恶或犯错。经济风险则更为复杂，且因不同的 DeFi 原语或协议而异。例如：
* 借贷市场：风险在于清算。如果市场没有使用合适的预言机，有时会发生错误清算。
* DEX 流动性提供者：风险在于无常损失（Impermanent Loss）。
* 稳定币或流动性质押：主要风险是脱锚（Loss of the Peg）。

在使用任何 DeFi 协议之前，深入了解其涉及的所有风险至关重要。除风险外，DeFi 还面临重大挑战。许多协议只是现有协议的副本（Fork），
试图在没有真实创新的情况下对现有项目发起“吸血鬼攻击（Vampire Attack）”。这不仅分散了流动性和用户，也稀释了整个生态系统的有效性。

流动性对大多数协议而言是生命线。虽然它们在牛市中可能运作良好，但在市场低迷期往往会严重退化。大多数 DeFi 协议并不能自给自足，
往往只有在提供激励时才能运作——这可能是因为用户并非对产品真正感兴趣，或是因为使用成本超过了收益。

尽管 DeFi 展示了一定的产品市场契合度（PMF），但其未来仍不确定。它可能演变成全球基础设施中引人注目的一部分（这是最可能的结局），
也可能仅作为一个针对特定用户群体的分众市场。

DeFi 面临的一个重大挑战是监管。不同国家和监管机构的监管环境差异巨大，大多数监管者反对完全去中心化的系统。
虽然监管机构无法直接关停此类系统——如果一个智能合约是不可篡改且部署在链上的，监管机构无法直接干预——但他们可以针对开发者和用户，增加其使用这些合约的难度。

Tornado Cash 就是一个典型案例。其开发者 Alexey Pertsev 在荷兰被判处 64 个月监禁。
继美国财政部因指控朝鲜黑客组织 Lazarus 利用 Tornado Cash 洗钱而将其列入黑名单后，他于 2022 年 8 月因洗钱罪被捕。
虽然 Tornado Cash 协议目前依然可用，但其流动性已大幅下降，导致用户体验变差。此外，使用过 Tornado Cash 的地址会被中心化交易所标记，增加了使用难度。

类似的状况也发生在其他生态中，例如 Samourai Wallet 的开发者也面临法律诉讼。这种模式表明，虽然监管机构无法攻击区块链本身，但他们可以针对其用户和开发者。

> [!Note]
> 尽管本书作者可能不具备充分理解 Samourai Wallet 或 Tornado Cash 案件的法律专业知识，
> 但我们并不支持针对编写去中心化代码的个人采取法律行动。代码应当保持自由，工具的创造者不应因他人的误用而受惩。
> 希望未来不再有开发者不得不面对此类不公正的后果。

## 结语
DeFi 使其用户能够更灵活地管理资金，创造了新的机遇和创新的金融原语（例如闪电贷）。作为加密货币领域内的一个新兴市场，
DeFi 正在飞速发展，但除了代币交易、稳定币和衍生品创建之外，它尚未在更广泛的领域找到完全契合的产品市场定位。


